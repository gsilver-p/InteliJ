<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.board.dao.BoardDao">

    <insert id="insertDummyData">
        insert into board
        values (null, #{b_title}, #{b_contents}, #{b_writer}, default, default)
    </insert>

    <select id="getBoardList" parameterType="HashMap" resultType="com.example.board.dto.BoardDto">
        select b_num, b_title, b_writer, b_date, b_view from board order by b_num desc limit #{startIndex}, #{listCnt}
    </select>

    <select id="getBoardListSearch" resultType="com.example.board.dto.BoardDto">
        select b_num, b_title, b_writer, b_date, b_view from board
        <if test="colname != null and colname != ''">
        where ${colname} like concat('%',#{keyword},'%')
        </if>
        order by b_num desc limit #{startIndex}, #{listCnt}
    </select>

    <select id="getBoardListSearchNew" resultType="com.example.board.dto.BoardDto">
        select b_num, b_title, b_writer, b_date, b_view from board
        <choose>
        <when test="keyword!=null and keyword!=''">
            where ${colname} like concat('%',#{keyword},'%')
            order by b_num desc limit #{startIndex}, #{listCnt}
        </when>
        <otherwise>
            order by b_num desc limit #{startIndex}, #{listCnt}
        </otherwise>
        </choose>
    </select>

    <select id="getBoardCount" resultType="java.lang.Integer">
        select count(*) from board
        <if test="colname!=null and colname!=''">
            where ${colname} like concat('%',#{keyword},'%')
        </if>
    </select>

    <select id="getBoardDetail" resultType="com.example.board.dto.BoardDto">
        select b_num, b_title, b_contents, b_writer, b_view, b_date from board where b_num = #{b_num}
    </select>

    <delete id="baordDelete">
        delete from board where b_num=#{b_num};
    </delete>

    <!--Oracle - selectKey만 사용가능-->
<!--<insert id="boardWriteSelectKey" parameterType="BoardDto">-->
<!-- insert into board values(null,#{b_title},#{b_contents},#{b_writer},default,default)-->
<!--<selectKey keyProperty="b_num" resultType="Integer" order="AFTER">-->
<!--select last_insert_id()   &lt;!&ndash;가장 최근 오토인크리먼트 생성 값&ndash;&gt;-->
<!--</selectKey>-->
<!-- </insert>-->

    <!--MySql - selectKeym useGeneratedKeys(간단,권장) 가능-->
    <insert id="boardWriteSelectKey" useGeneratedKeys="true" keyProperty="b_num">
        insert into board values(null,#{b_title},#{b_contents},#{b_writer},default,default)
    </insert>

    <insert id="fileInsertMap" parameterType="HashMap">
        insert into boardfile values(null,#{b_num},#{oriFileName},#{sysFileName})
    </insert>

    <select id="getBoardFileList" resultType="com.example.board.dto.BoardFile">
        select bf_orifilename, bf_sysfilename from boardfile where bf_bnum=#{bNum}
    </select>
</mapper>